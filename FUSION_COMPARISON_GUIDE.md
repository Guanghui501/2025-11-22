# èåˆæœºåˆ¶å¯¹æ¯”å®éªŒä½¿ç”¨æŒ‡å—

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•ç›´è§‚åœ°è§‚å¯Ÿå„ä¸ªèåˆæ¨¡å—ä½œç”¨ä¸‹çš„å›¾ã€æ–‡æœ¬ç‰¹å¾å˜åŒ–ï¼Œä»¥åŠå¦‚ä½•ä½“ç°"ä¸­æœŸèåˆ+ç»†ç²’åº¦æ³¨æ„åŠ›+è·¨æ¨¡æ€æ³¨æ„åŠ›"ç»„åˆçš„ä¼˜åŠ¿ã€‚

---

## ğŸ“š å·¥å…·æ¦‚è§ˆ

### 1. `compare_fusion_mechanisms.py` - èåˆæœºåˆ¶å¯¹æ¯”
**åŠŸèƒ½**: æ¶ˆèå®éªŒï¼Œå¯¹æ¯”ä¸åŒèåˆé…ç½®çš„æ•ˆæœ
- æå–ä¸åŒé˜¶æ®µçš„ç‰¹å¾ï¼ˆåŸºç¡€ã€ä¸­é—´èåˆã€ç»†ç²’åº¦ã€å…¨å±€æ³¨æ„åŠ›ï¼‰
- t-SNEå¯è§†åŒ–ç‰¹å¾ç©ºé—´å˜åŒ–
- å®šé‡è¯„ä¼°ï¼ˆèšç±»è´¨é‡ã€åˆ†ç¦»åº¦ç­‰ï¼‰
- ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š

### 2. `visualize_attention_weights.py` - æ³¨æ„åŠ›æƒé‡å¯è§†åŒ–
**åŠŸèƒ½**: å¯è§†åŒ–ç»†ç²’åº¦æ³¨æ„åŠ›çš„åŸå­-è¯å¯¹åº”å…³ç³»
- åŒå‘æ³¨æ„åŠ›çƒ­å›¾
- æ³¨æ„åŠ›æƒé‡åˆ†å¸ƒç»Ÿè®¡
- é«˜æƒé‡åŸå­-è¯å¯¹åˆ†æ

### 3. `visualize_fusion_flow.py` - èåˆæµç¨‹å¯è§†åŒ–
**åŠŸèƒ½**: ç”Ÿæˆèåˆæœºåˆ¶çš„æ—¶é—´çº¿å›¾å’Œç‰¹å¾ç»´åº¦å¯¹æ¯”å›¾

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶

1. **è®­ç»ƒå¥½çš„æ¨¡å‹checkpoint**ï¼ŒåŒ…å«ä¸åŒèåˆé…ç½®ï¼š
   - åŸºç¡€æ¨¡å‹ï¼ˆæ— èåˆï¼‰
   - å¯ç”¨ä¸­é—´èåˆçš„æ¨¡å‹
   - å¯ç”¨ç»†ç²’åº¦æ³¨æ„åŠ›çš„æ¨¡å‹
   - å¯ç”¨æ‰€æœ‰èåˆæœºåˆ¶çš„æ¨¡å‹

2. **æ•°æ®é›†**å‡†å¤‡å¥½åœ¨ `./dataset` ç›®å½•ä¸‹

---

## å®éªŒ1: å¯¹æ¯”ä¸åŒèåˆæœºåˆ¶çš„æ•ˆæœ

### åŸºæœ¬ç”¨æ³•

```bash
python compare_fusion_mechanisms.py \
    --checkpoint path/to/best_model.pt \
    --dataset jarvis \
    --property formation_energy \
    --root_dir ./dataset \
    --save_dir ./fusion_comparison \
    --max_samples 500 \
    --device cuda
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|-------|
| `--checkpoint` | æ¨¡å‹checkpointè·¯å¾„ï¼ˆå¿…éœ€ï¼‰ | - |
| `--dataset` | æ•°æ®é›†ç±»å‹ (jarvis/mp/class) | - |
| `--property` | å±æ€§åç§° | - |
| `--root_dir` | æ•°æ®é›†æ ¹ç›®å½• | `./dataset` |
| `--save_dir` | ç»“æœä¿å­˜ç›®å½• | `./fusion_comparison` |
| `--max_samples` | æœ€å¤§æ ·æœ¬æ•°ï¼ˆåŠ é€Ÿå®éªŒï¼‰ | 500 |
| `--device` | è®¾å¤‡ (cpu/cuda) | `cpu` |
| `--batch_size` | æ‰¹æ¬¡å¤§å° | 32 |
| `--split` | æ•°æ®é›†åˆ’åˆ† (train/val/test) | `test` |

### è¾“å‡ºæ–‡ä»¶

è¿è¡Œåä¼šåœ¨ `save_dir` ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

1. **`feature_comparison_tsne.pdf/png`**
   - 6ä¸ªå­å›¾å¹¶æ’å¯¹æ¯”
   - å±•ç¤ºä¸åŒèåˆé˜¶æ®µçš„ç‰¹å¾ç©ºé—´

2. **`metrics_comparison.pdf/png`**
   - 5ä¸ªå®šé‡æŒ‡æ ‡çš„æŸ±çŠ¶å›¾å¯¹æ¯”
   - åŒ…æ‹¬Silhouette Scoreã€Davies-Bouldinç­‰

3. **`comparison_report.txt`**
   - è¯¦ç»†çš„æ•°å€¼å¯¹æ¯”è¡¨æ ¼
   - æœ€ä½³é…ç½®åˆ†æ
   - å»ºè®®

### è§£è¯»ç»“æœ

#### ç‰¹å¾ç©ºé—´å¯è§†åŒ–

è§‚å¯Ÿ6ä¸ªå­å›¾çš„åŒºåˆ«ï¼š

```
1. Graph (No Fusion)        â† åŸºçº¿ï¼šçº¯å›¾ç‰¹å¾
   â””â”€ èšç±»å¯èƒ½ä¸å¤Ÿç´§å¯†

2. Text (No Fusion)         â† åŸºçº¿ï¼šçº¯æ–‡æœ¬ç‰¹å¾
   â””â”€ å¯èƒ½è¿‡äºä¾èµ–æ–‡æœ¬æè¿°

3. Graph (+ Middle Fusion)  â† ä¸­é—´èåˆçš„å½±å“
   â””â”€ å›¾ç‰¹å¾å¼€å§‹å—æ–‡æœ¬è°ƒåˆ¶

4. Graph (+ Fine-grained)   â† ç»†ç²’åº¦æ³¨æ„åŠ›çš„å½±å“
   â””â”€ åŸå­-è¯äº¤äº’åçš„å›¾ç‰¹å¾

5. Graph (+ Cross-modal)    â† å…¨å±€æ³¨æ„åŠ›çš„å½±å“
   â””â”€ æ·±åº¦èåˆçš„å›¾ç‰¹å¾

6. Fused (All Mechanisms)   â† å®Œæ•´èåˆ
   â””â”€ åº”è¯¥èšç±»æœ€ç´§å¯†ã€åˆ†ç¦»æœ€æ˜æ˜¾
```

**è§‚å¯Ÿè¦ç‚¹**:
- âœ… ç°‡æ˜¯å¦æ›´ç´§å¯†ï¼Ÿï¼ˆåŒç±»æ ·æœ¬æ˜¯å¦èšåœ¨ä¸€èµ·ï¼‰
- âœ… ç±»é—´è·ç¦»æ˜¯å¦æ›´å¤§ï¼Ÿï¼ˆä¸åŒç±»æ˜¯å¦åˆ†å¾—æ›´å¼€ï¼‰
- âœ… è¾¹ç•Œæ˜¯å¦æ›´æ¸…æ™°ï¼Ÿ

#### å®šé‡æŒ‡æ ‡

**Silhouette Score** (è¶Šé«˜è¶Šå¥½ï¼ŒèŒƒå›´-1åˆ°1):
- 0.7-1.0: ä¼˜ç§€çš„èšç±»
- 0.5-0.7: åˆç†çš„èšç±»
- 0.25-0.5: èšç±»ç»“æ„è¾ƒå¼±
- < 0.25: æ— æ˜æ˜¾èšç±»ç»“æ„

**Davies-Bouldin Index** (è¶Šä½è¶Šå¥½):
- è¶Šæ¥è¿‘0è¶Šå¥½
- è¡¨ç¤ºç°‡å†…ç´§å‡‘åº¦vsç°‡é—´åˆ†ç¦»åº¦

**Separation** (è¶Šé«˜è¶Šå¥½):
- = ç±»å†…ç›¸ä¼¼åº¦ - ç±»é—´ç›¸ä¼¼åº¦
- æ­£å€¼è¶Šå¤§è¯´æ˜ç±»å†…ç´§å¯†ã€ç±»é—´åˆ†ç¦»

### ç¤ºä¾‹å¯¹æ¯”ç»“æœ

```
Feature Type         Silhouette  Davies-B  Separation
----------------------------------------------------------
graph_base             0.3254      1.8234     0.1456
text_base              0.2891      2.1023     0.0923
graph_middle           0.4102      1.6541     0.2134  â† ä¸­é—´èåˆæå‡
graph_fine             0.4567      1.4932     0.2789  â† ç»†ç²’åº¦æ³¨æ„åŠ›æå‡
graph_cross            0.4821      1.3654     0.3012  â† å…¨å±€æ³¨æ„åŠ›æå‡
fused                  0.5234      1.2103     0.3456  â† ç»„åˆæ•ˆæœæœ€å¥½ï¼
```

**ç»“è®º**: èåˆæœºåˆ¶çš„ç´¯ç§¯æ•ˆæœæ˜æ˜¾ï¼

---

## å®éªŒ2: å¯è§†åŒ–æ³¨æ„åŠ›æƒé‡

### åŸºæœ¬ç”¨æ³•

```bash
python visualize_attention_weights.py \
    --checkpoint path/to/fine_grained_model.pt \
    --dataset jarvis \
    --property formation_energy \
    --root_dir ./dataset \
    --save_dir ./attention_visualization \
    --num_examples 5 \
    --device cuda
```

**æ³¨æ„**: æ¨¡å‹å¿…é¡»å¯ç”¨äº† `use_fine_grained_attention=True`

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|-------|
| `--num_examples` | å¯è§†åŒ–çš„æ ·æœ¬æ•° | 5 |
| å…¶ä»–å‚æ•° | ä¸å¯¹æ¯”è„šæœ¬ç›¸åŒ | - |

### è¾“å‡ºæ–‡ä»¶

1. **`attention_sample_*_bidirectional.pdf/png`**
   - æ¯ä¸ªæ ·æœ¬çš„åŒå‘æ³¨æ„åŠ›çƒ­å›¾
   - å·¦: åŸå­â†’æ–‡æœ¬ï¼ˆå“ªä¸ªåŸå­å…³æ³¨å“ªä¸ªè¯ï¼‰
   - å³: æ–‡æœ¬â†’åŸå­ï¼ˆå“ªä¸ªè¯å…³æ³¨å“ªä¸ªåŸå­ï¼‰

2. **`attention_distribution.pdf/png`**
   - æ³¨æ„åŠ›æƒé‡çš„ç»Ÿè®¡åˆ†å¸ƒ
   - ç›´æ–¹å›¾ã€CDFã€Boxplotã€ç»Ÿè®¡è¡¨

3. **`attention_analysis.txt`**
   - Top-5é«˜æƒé‡çš„åŸå­-è¯å¯¹
   - ç¨€ç–åº¦åˆ†æ
   - æ¯ä¸ªæ ·æœ¬çš„ç»Ÿè®¡ä¿¡æ¯

### è§£è¯»æ³¨æ„åŠ›çƒ­å›¾

#### åŸå­â†’æ–‡æœ¬æ³¨æ„åŠ›

```
              copper  oxide  superconductor  thermal
CuåŸå­         0.85    0.10      0.03         0.02   â† Cuå¼ºçƒˆå…³æ³¨"copper"
OåŸå­          0.08    0.82      0.05         0.05   â† Oå¼ºçƒˆå…³æ³¨"oxide"
FeåŸå­         0.45    0.15      0.20         0.20   â† Feåˆ†æ•£æ³¨æ„å¤šä¸ªè¯
```

**è§‚å¯Ÿè¦ç‚¹**:
- âœ… åŒ–å­¦å…ƒç´ æ˜¯å¦å…³æ³¨å¯¹åº”çš„è¯ï¼Ÿï¼ˆå¦‚Cuâ†’"copper"ï¼‰
- âœ… æƒé‡åˆ†å¸ƒæ˜¯å¦åˆç†ï¼Ÿï¼ˆä¸æ˜¯å‡åŒ€åˆ†å¸ƒï¼‰
- âœ… æ˜¯å¦æœ‰æ„å¤–çš„é«˜æƒé‡å¯¹ï¼Ÿï¼ˆå¯èƒ½å‘ç°æœ‰è¶£çš„å…³è”ï¼‰

#### æ–‡æœ¬â†’åŸå­æ³¨æ„åŠ›

```
                Cu    O     Fe    ...
"copper"       0.90  0.05  0.05  ...  â† "copper"è¯å…³æ³¨CuåŸå­
"oxide"        0.10  0.80  0.10  ...  â† "oxide"è¯å…³æ³¨OåŸå­
"thermal"      0.30  0.30  0.40  ...  â† "thermal"å‡åŒ€å…³æ³¨ï¼ˆæ•´ä½“æ€§è´¨ï¼‰
```

**è§‚å¯Ÿè¦ç‚¹**:
- âœ… ææ–™æ€§è´¨è¯æ˜¯å¦å…³æ³¨ç›¸å…³åŸå­ï¼Ÿ
- âœ… æè¿°æ€§è¯æ±‡çš„æ³¨æ„åŠ›æ¨¡å¼

### æ³¨æ„åŠ›æƒé‡åˆ†å¸ƒ

**ç†æƒ³åˆ†å¸ƒ**:
- ä¸æ˜¯å‡åŒ€åˆ†å¸ƒï¼ˆè¯´æ˜æœ‰é€‰æ‹©æ€§ï¼‰
- æœ‰æ˜æ˜¾çš„é«˜æƒé‡å³°å€¼ï¼ˆå¼ºå…³è”ï¼‰
- å¤§éƒ¨åˆ†æƒé‡è¾ƒä½ï¼ˆç¨€ç–æ€§ï¼Œå…³æ³¨é‡ç‚¹ï¼‰

**ç¨€ç–åº¦**:
- 60-80%çš„æƒé‡ < 0.1 æ˜¯æ­£å¸¸çš„
- è¯´æ˜æ¨¡å‹æœ‰é€‰æ‹©æ€§åœ°å…³æ³¨é‡è¦éƒ¨åˆ†

---

## å®éªŒ3: å¯¹æ¯”ä¸åŒæ¨¡å‹é…ç½®

å¦‚æœæ‚¨è®­ç»ƒäº†å¤šä¸ªä¸åŒé…ç½®çš„æ¨¡å‹ï¼Œå¯ä»¥ç³»ç»Ÿå¯¹æ¯”ï¼š

### é…ç½®1: æ— èåˆï¼ˆåŸºçº¿ï¼‰

```python
# config
use_contrastive_loss = False
use_middle_fusion = False
use_fine_grained_attention = False
use_cross_modal_attention = False
```

### é…ç½®2: åªç”¨å¯¹æ¯”å­¦ä¹ 

```python
use_contrastive_loss = True
use_middle_fusion = False
use_fine_grained_attention = False
use_cross_modal_attention = False
```

### é…ç½®3: ä¸­é—´èåˆ

```python
use_contrastive_loss = True
use_middle_fusion = True
middle_fusion_layers = "2"
use_fine_grained_attention = False
use_cross_modal_attention = False
```

### é…ç½®4: ç»†ç²’åº¦æ³¨æ„åŠ›

```python
use_contrastive_loss = True
use_middle_fusion = True
use_fine_grained_attention = True
use_cross_modal_attention = False
```

### é…ç½®5: å®Œæ•´èåˆ â­

```python
use_contrastive_loss = True
use_middle_fusion = True
use_fine_grained_attention = True
use_cross_modal_attention = True
```

### æ‰¹é‡å¯¹æ¯”

```bash
#!/bin/bash

configs=(
    "baseline:models/baseline.pt"
    "contrastive:models/contrastive.pt"
    "middle:models/middle_fusion.pt"
    "fine:models/fine_grained.pt"
    "full:models/full_fusion.pt"
)

for config in "${configs[@]}"; do
    name="${config%%:*}"
    checkpoint="${config##*:}"

    echo "Processing $name..."
    python compare_fusion_mechanisms.py \
        --checkpoint "$checkpoint" \
        --dataset jarvis \
        --property formation_energy \
        --save_dir "./comparison_$name" \
        --max_samples 500
done

echo "All comparisons done!"
```

---

## ğŸ“Š é¢„æœŸå®éªŒç»“æœ

### ç‰¹å¾ç©ºé—´æ¼”åŒ–

```
åŸºçº¿ (No Fusion)
  â—  â—  â—  â—  â—
  â—‹  â—‹  â—‹  â—‹  â—‹
  (å›¾å’Œæ–‡æœ¬ç‹¬ç«‹ï¼Œèšç±»æ¨¡ç³Š)

â†“ + å¯¹æ¯”å­¦ä¹ 

  â—â—‹ â—â—‹ â—â—‹ â—â—‹ â—â—‹
  (å¯¹é½ä½†æœªæ·±åº¦èåˆ)

â†“ + ä¸­é—´èåˆ

  â—' â—' â—' â—' â—'
  (å›¾ç‰¹å¾å—æ–‡æœ¬è°ƒåˆ¶ï¼Œå¼€å§‹èšåˆ)

â†“ + ç»†ç²’åº¦æ³¨æ„åŠ›

  â—" â—" â—" â—"
  â—‹" â—‹" â—‹" â—‹"
  (åŒå‘å¢å¼ºï¼Œç°‡æ›´ç´§å¯†)

â†“ + å…¨å±€æ³¨æ„åŠ›

  âŠ•  âŠ•  âŠ•  âŠ•
  (æ·±åº¦èåˆï¼Œåˆ†ç¦»æ˜æ˜¾)
```

### å®šé‡æŒ‡æ ‡è¶‹åŠ¿

```
                Baseline â†’ Contrastive â†’ Middle â†’ Fine â†’ Full
Silhouette:      0.30       0.35         0.41     0.46   0.52  â†‘
Davies-Bouldin:  1.85       1.75         1.65     1.49   1.21  â†“
Separation:      0.10       0.15         0.21     0.28   0.35  â†‘
```

### æ³¨æ„åŠ›æ¨¡å¼

**è‰¯å¥½çš„æ³¨æ„åŠ›æ¨¡å¼**:
- åŒ–å­¦å…ƒç´ è¯ â†” å¯¹åº”å…ƒç´ åŸå­ï¼ˆé«˜æƒé‡ï¼‰
- æ€§è´¨è¯ â†’ å¤šä¸ªç›¸å…³åŸå­ï¼ˆä¸­ç­‰æƒé‡ï¼Œåˆ†å¸ƒï¼‰
- ç»“æ„è¯ â†’ ç‰¹å®šä½ç½®åŸå­ï¼ˆå±€éƒ¨é«˜æƒé‡ï¼‰

---

## ğŸ’¡ å¦‚ä½•ä½“ç°"ç»„åˆ"çš„ä¼˜åŠ¿

### 1. ç‰¹å¾ç©ºé—´å¯è§†åŒ–å¯¹æ¯”

**å•ä¸€æœºåˆ¶**:
- åªç”¨å¯¹æ¯”å­¦ä¹ : å¯¹é½ä½†ä¸å¤Ÿèåˆ
- åªç”¨ä¸­é—´èåˆ: å›¾ç‰¹å¾æ”¹å–„ï¼Œä½†æ–‡æœ¬æœªå¢å¼º
- åªç”¨ç»†ç²’åº¦: æœ‰äº¤äº’ä½†ç¼ºå°‘æ—©æœŸå¼•å¯¼

**ç»„åˆæœºåˆ¶**:
- å¯¹æ¯”å­¦ä¹  + ä¸­é—´èåˆ: æ—©æœŸå¯¹é½ + ç¼–ç æœŸè°ƒåˆ¶
- å†åŠ ç»†ç²’åº¦: åŸå­-è¯ç²¾ç»†å¯¹é½
- å†åŠ å…¨å±€: æœ€ç»ˆæ·±åº¦èåˆ

**ä½“ç°**: `fused` çš„èšç±»è´¨é‡æ˜æ˜¾ä¼˜äºå•ä¸€æœºåˆ¶

### 2. å®šé‡æŒ‡æ ‡æå‡

åˆ¶ä½œæŠ˜çº¿å›¾å±•ç¤ºç´¯ç§¯æ•ˆæœ:

```python
import matplotlib.pyplot as plt

mechanisms = ['Baseline', '+Contrast', '+Middle', '+Fine', '+Cross']
silhouette = [0.30, 0.35, 0.41, 0.46, 0.52]

plt.plot(mechanisms, silhouette, marker='o', linewidth=2)
plt.ylabel('Silhouette Score')
plt.title('Cumulative Effect of Fusion Mechanisms')
plt.grid(alpha=0.3)
plt.show()
```

### 3. æ¶ˆèå®éªŒè¡¨æ ¼

| é…ç½® | å¯¹æ¯” | ä¸­é—´ | ç»†ç²’åº¦ | å…¨å±€ | Silhouette | Î” |
|-----|-----|-----|--------|-----|-----------|---|
| 1 | âŒ | âŒ | âŒ | âŒ | 0.30 | - |
| 2 | âœ… | âŒ | âŒ | âŒ | 0.35 | +0.05 |
| 3 | âœ… | âœ… | âŒ | âŒ | 0.41 | +0.06 |
| 4 | âœ… | âœ… | âœ… | âŒ | 0.46 | +0.05 |
| 5 | âœ… | âœ… | âœ… | âœ… | 0.52 | +0.06 |

**ç»“è®º**: æ¯ä¸ªæœºåˆ¶éƒ½è´¡çŒ®å¢ç›Šï¼Œç»„åˆæ•ˆæœæœ€ä½³ï¼

### 4. æ³¨æ„åŠ›å¯è§£é‡Šæ€§

ç»†ç²’åº¦æ³¨æ„åŠ›æä¾›çš„ç‹¬ç‰¹ä»·å€¼ï¼š
- âœ… å¯è§†åŒ–åŸå­-è¯å¯¹åº”å…³ç³»
- âœ… éªŒè¯æ¨¡å‹æ˜¯å¦çœŸæ­£"ç†è§£"ææ–™
- âœ… å‘ç°æœ‰è¶£çš„åŒ–å­¦å…³è”

ç¤ºä¾‹å‘ç°:
```
"superconductor" â†’ Cu-Oå±‚åŸå­ï¼ˆé«˜æƒé‡ï¼‰
â†’ æ¨¡å‹å­¦åˆ°äº†è¶…å¯¼æ€§ä¸Cu-Oå±‚çš„å…³è”ï¼
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å®éªŒé¡ºåº

```
æ­¥éª¤1: è®­ç»ƒåŸºçº¿æ¨¡å‹ï¼ˆæ— èåˆï¼‰
  â†“
æ­¥éª¤2: é€æ­¥æ·»åŠ èåˆæœºåˆ¶ï¼Œæ¯æ¬¡è®­ç»ƒä¸€ä¸ªæ¨¡å‹
  â†“
æ­¥éª¤3: ä½¿ç”¨ compare_fusion_mechanisms.py å¯¹æ¯”
  â†“
æ­¥éª¤4: ä½¿ç”¨ visualize_attention_weights.py åˆ†ææ³¨æ„åŠ›
  â†“
æ­¥éª¤5: æ±‡æ€»ç»“æœï¼Œåˆ¶ä½œå¯¹æ¯”å›¾è¡¨
```

### 2. æ ·æœ¬æ•°é€‰æ‹©

- **å¿«é€Ÿæµ‹è¯•**: `--max_samples 200`
- **æ­£å¼å®éªŒ**: `--max_samples 500-1000`
- **å®Œæ•´è¯„ä¼°**: ä¸è®¾ `max_samples`ï¼ˆä½¿ç”¨å…¨éƒ¨æ•°æ®ï¼‰

### 3. å¯è§†åŒ–æŠ€å·§

**t-SNEå‚æ•°è°ƒä¼˜**:
- `perplexity`: æ ·æœ¬æ•°çš„1-5%
- å¤šæ¬¡è¿è¡Œå–æœ€å¥½çš„ï¼ˆt-SNEæœ‰éšæœºæ€§ï¼‰

**æ³¨æ„åŠ›çƒ­å›¾**:
- é™åˆ¶åŸå­æ•°å’Œtokenæ•°ï¼ˆå¤ªå¤šçœ‹ä¸æ¸…ï¼‰
- åªæ˜¾ç¤ºæƒé‡>0.05çš„å€¼

### 4. æŠ¥å‘Šæ’°å†™

#### ç»“æ„å»ºè®®

```markdown
## å®éªŒç›®æ ‡
å¯¹æ¯”ä¸åŒèåˆæœºåˆ¶çš„æ•ˆæœ

## å®éªŒè®¾ç½®
- æ•°æ®é›†: ...
- æ¨¡å‹é…ç½®: ...
- è¯„ä¼°æŒ‡æ ‡: ...

## å®éªŒç»“æœ

### 1. ç‰¹å¾ç©ºé—´å¯è§†åŒ–
[æ’å…¥ feature_comparison_tsne.png]

è§‚å¯Ÿ:
- åŸºçº¿æ¨¡å‹èšç±»æ¨¡ç³Š
- å®Œæ•´èåˆèšç±»æ¸…æ™°ï¼Œåˆ†ç¦»æ˜æ˜¾

### 2. å®šé‡è¯„ä¼°
[æ’å…¥ metrics_comparison.png]

ç»“æœ:
- Silhouette: 0.30 â†’ 0.52 (+73%)
- Davies-Bouldin: 1.85 â†’ 1.21 (-35%)

### 3. æ³¨æ„åŠ›åˆ†æ
[æ’å…¥æ³¨æ„åŠ›çƒ­å›¾]

å‘ç°:
- CuåŸå­å…³æ³¨"copper"è¯ï¼ˆæƒé‡0.85ï¼‰
- "thermal"è¯å‡åŒ€å…³æ³¨å¤šä¸ªåŸå­

## ç»“è®º
ç»„åˆèåˆæœºåˆ¶å¸¦æ¥æ˜¾è‘—æå‡...
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: å†…å­˜ä¸è¶³

**è§£å†³**:
```bash
--max_samples 100  # å‡å°‘æ ·æœ¬æ•°
--batch_size 8     # å‡å°æ‰¹æ¬¡
--device cpu       # ä½¿ç”¨CPU
```

### é—®é¢˜2: æ¨¡å‹æœªå¯ç”¨æŸäº›èåˆæœºåˆ¶

**è§£å†³**:
- æ£€æŸ¥checkpointä¸­çš„config
- ä½¿ç”¨ç›¸åº”é…ç½®çš„æ¨¡å‹

```python
checkpoint = torch.load('model.pt')
config = checkpoint['config']
print(f"ä¸­é—´èåˆ: {config.use_middle_fusion}")
print(f"ç»†ç²’åº¦: {config.use_fine_grained_attention}")
```

### é—®é¢˜3: å¯è§†åŒ–å›¾ç‰‡è´¨é‡å·®

**è§£å†³**:
- å¢åŠ DPI: ä¿®æ”¹è„šæœ¬ä¸­çš„ `dpi=300` â†’ `dpi=600`
- è°ƒæ•´å›¾ç‰‡å¤§å°: `figsize=(14, 10)` â†’ `figsize=(20, 14)`

### é—®é¢˜4: æ³¨æ„åŠ›æƒé‡å…¨æ˜¯0

**åŸå› **: æ¨¡å‹æœªæ­£ç¡®è®­ç»ƒæˆ–æœªå¯ç”¨æ³¨æ„åŠ›

**è§£å†³**:
- ç¡®è®¤ `use_fine_grained_attention=True`
- æ£€æŸ¥è®­ç»ƒæ—¥å¿—

---

## ğŸ“ ç¤ºä¾‹å®Œæ•´æµç¨‹

```bash
# 1. å¯¹æ¯”èåˆæœºåˆ¶
python compare_fusion_mechanisms.py \
    --checkpoint outputs/full_fusion/best_val_model.pt \
    --dataset jarvis \
    --property formation_energy \
    --save_dir ./results/fusion_comparison \
    --max_samples 500 \
    --device cuda

# 2. å¯è§†åŒ–æ³¨æ„åŠ›
python visualize_attention_weights.py \
    --checkpoint outputs/full_fusion/best_val_model.pt \
    --dataset jarvis \
    --property formation_energy \
    --save_dir ./results/attention_viz \
    --num_examples 10 \
    --device cuda

# 3. æŸ¥çœ‹ç»“æœ
cd results/fusion_comparison
ls -lh
# feature_comparison_tsne.pdf
# metrics_comparison.pdf
# comparison_report.txt

cd ../attention_viz
ls -lh
# attention_sample_*_bidirectional.pdf
# attention_distribution.pdf
# attention_analysis.txt

# 4. æ‰“å¼€PDFæŸ¥çœ‹
# æ¨èä½¿ç”¨PDFé˜…è¯»å™¨åŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶å¯¹æ¯”
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `MODAL_FUSION_MECHANISMS.md` - èåˆæœºåˆ¶è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
- `README_FUSION_MECHANISMS.md` - å¿«é€Ÿå‚è€ƒæŒ‡å—
- `visualize_fusion_flow.py` - èåˆæµç¨‹å¯è§†åŒ–è„šæœ¬

---

**æ›´æ–°æ—¶é—´**: 2025-11-22
**ä½œè€…**: Claude Code Assistant
